<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Versioning in cdpx -->
  <PropertyGroup Condition=" $(CDP_FILE_VERSION_NUMERIC) != '' ">
    <!-- Use the build number generated by CDPX. -->
    <Version>$(CDP_FILE_VERSION_NUMERIC)</Version>

    <!-- Prepare assembly metadata -->
    <Authors>Microsoft Corporation</Authors>
    <Copyright>© Microsoft Corporation. All rights reserved.</Copyright>
    <AssemblyVersion>$(Version)</AssemblyVersion>
    <FileVersion>$(Version)</FileVersion>
    <InformationalVersion>$(CDP_FILE_VERSION_NUMERIC) Commit Hash: $(CDP_COMMIT_ID)</InformationalVersion>

    <!-- Save commit hash -->
    <Description>Commit Hash: $(CDP_COMMIT_ID)</Description>
  </PropertyGroup>
  <!-- Versioning in VSO -->
  <PropertyGroup Condition=" $(CDP_FILE_VERSION_NUMERIC) == '' ">
    <!-- Reset $(BuildEpoch) whenever $(VersionPrefix) increments. We subtract this from YYYYMMDD portion of build
           number below to obtain the fourth part of file version that must fit in 16 bits. We can produce builds 
           for seven years from every epoch reset. -->
    <VersionPrefix Condition="'$(VersionPrefix)' == ''">1.0.0</VersionPrefix>
    <BuildEpoch>20170101</BuildEpoch>

    <!-- When running on VSO (for official builds) use a real number. -->
    <BuildNumber Condition="'$(BuildNumber)' == ''">$(BUILD_BUILDNUMBER)</BuildNumber>
    <BuildNumber Condition="'$(BuildNumber)' == ''">00000001.1</BuildNumber>
    <VersionSuffix Condition="'$(VersionSuffix)' == ''">$(VersionPrereleasePrefix)-$(BuildNumber)</VersionSuffix>
    <Version Condition="'$(Version)' == ''">$(VersionPrefix)-$(VersionSuffix)</Version>

    <!-- Prepare Version number used in template builds -->
    <BuildNumberPart1>$(BuildNumber.Split('.')[0])</BuildNumberPart1>
    <BuildNumberPart2>$(BuildNumber.Split('.')[1].PadLeft(2,'0'))</BuildNumberPart2>

    <!-- Prepare assembly metadata -->
    <Authors>Microsoft Corporation</Authors>
    <Copyright>© Microsoft Corporation. All rights reserved.</Copyright>
    <CorrectedVersion Condition="'$(BUILD_BUILDNUMBER)' == ''">$(VersionPrefix).0</CorrectedVersion>
    <CorrectedVersion Condition="'$(BUILD_BUILDNUMBER)' != ''">$(VersionPrefix).$([MSBuild]::Subtract($(BuildNumberPart1), $(BuildEpoch)))</CorrectedVersion>
    <AssemblyVersion>$(CorrectedVersion)</AssemblyVersion>
    <FileVersion>$(CorrectedVersion)</FileVersion>
    <InformationalVersion>$(VersionPrefix).$(BuildNumber)</InformationalVersion>
    <InformationalVersion Condition="'$(BUILD_SOURCEVERSION)' != ''">$(InformationalVersion). Commit Hash: $(BUILD_SOURCEVERSION)</InformationalVersion>

    <!-- Saving Commit Hash -->
    <Description Condition="'$(BUILD_SOURCEVERSION)' != ''">Commit Hash: $(BUILD_SOURCEVERSION)</Description>
  </PropertyGroup>
</Project>